description: "Test detection and tokenization of PII with relationship context"

input:
  message: "I am Bob McGibblets and I am looking for some help for my son Tim. We live at 87 Uptown Ave in Mineapolis, Minnesota 99999-1234. My email is bobby@noreply.com and my son's email is timmy@noreply.org. My phone is 888-555-9876. Please contact me so I can understand how to get Timmy some help, thank you."

expected:
  status: "success"
  sanitized_text: "I am [Person1] and I am looking for some help for my son [Person2]. We live at [Person1:address1]. My email is [Person1:email1] and my son's email is [Person2:email1]. My phone is [Person1:phone1]. Please contact me so I can understand how to get [Person2] some help, thank you."
  persons:
    Person1:
      primary_name: "Bob McGibblets"
      aliases: []
      emails: ["bobby@noreply.com"]
      phones: ["888-555-9876"]
      addresses: ["87 Uptown Ave, Mineapolis, Minnesota 99999-1234"]
      relationships:
        children: ["Person2"]
      metadata:
        confidence_score: 0.98
        session_count: 1
    Person2:
      primary_name: "Tim"
      aliases: ["Timmy"]
      emails: ["timmy@noreply.org"]
      phones: []
      addresses: ["87 Uptown Ave, Mineapolis, Minnesota 99999-1234"]
      relationships:
        parents: ["Person1"]
      metadata:
        confidence_score: 0.96
        session_count: 1
  token_map:
    "[Person1]": "primary_name"
    "[Person1:email1]": "emails[0]"
    "[Person1:phone1]": "phones[0]"
    "[Person1:address1]": "addresses[0]"
    "[Person2]": "primary_name"
    "[Person2:email1]": "emails[0]"

validation:
  required_fields:
    - status
    - sanitized_text
    - session_id
    - persons
    - token_map
    - pii_mapping
    - original_input
    - timestamp
  person_tokens:
    - "Person1"
    - "Person2"
  pii_attributes:
    - "primary_name"
    - "emails"
    - "phones"
    - "addresses"